<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">   
    <link rel="shortcut icon" href="../../../img/favicon.ico">

    <title></title>

    <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.018/css/hack.min.css">
    <link href='//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../../../css/base.css" rel="stylesheet">
    <link href="../../../css/cinder.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->

            <a class="navbar-brand" href="../../..">Statistical Learning with Python</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../../..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">2 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../chapter2/exercise1/">2.1</a>
</li>

                        
                            
<li >
    <a href="../../chapter2/exercise2/">2.2</a>
</li>

                        
                            
<li >
    <a href="../../chapter2/exercise3/">2.3</a>
</li>

                        
                            
<li >
    <a href="../../chapter2/exercise4/">2.4</a>
</li>

                        
                            
<li >
    <a href="../../chapter2/exercise5/">2.5</a>
</li>

                        
                            
<li >
    <a href="../../chapter2/exercise6/">2.6</a>
</li>

                        
                            
<li >
    <a href="../../chapter2/exercise7/">2.7</a>
</li>

                        
                            
<li >
    <a href="../../chapter2/exercise8/">2.8</a>
</li>

                        
                            
<li >
    <a href="../../chapter2/exercise9/">2.9</a>
</li>

                        
                            
<li >
    <a href="../../chapter2/exercise10/">2.10</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">3 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../chapter3/exercise1/">3.1</a>
</li>

                        
                            
<li >
    <a href="../../chapter3/exercise2/">3.2</a>
</li>

                        
                            
<li >
    <a href="../../chapter3/exercise3/">3.3</a>
</li>

                        
                            
<li >
    <a href="../../chapter3/exercise4/">3.4</a>
</li>

                        
                            
<li >
    <a href="../../chapter3/exercise5/">3.5</a>
</li>

                        
                            
<li >
    <a href="../../chapter3/exercise6/">3.6</a>
</li>

                        
                            
<li >
    <a href="../../chapter3/exercise7/">3.7</a>
</li>

                        
                            
<li >
    <a href="../../chapter3/exercise8/">3.8</a>
</li>

                        
                            
<li >
    <a href="../../chapter3/exercise9/">3.9</a>
</li>

                        
                            
<li >
    <a href="../../chapter3/exercise10/">3.10</a>
</li>

                        
                            
<li >
    <a href="../../chapter3/exercise11/">3.11</a>
</li>

                        
                            
<li >
    <a href="../../chapter3/exercise12/">3.12</a>
</li>

                        
                            
<li >
    <a href="../../chapter3/exercise13/">3.13</a>
</li>

                        
                            
<li >
    <a href="../../chapter3/exercise14/">3.14</a>
</li>

                        
                            
<li >
    <a href="../../chapter3/exercise15/">3.15</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">4 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../chapter4/exercise1/">4.1</a>
</li>

                        
                            
<li >
    <a href="../../chapter4/exercise2/">4.2</a>
</li>

                        
                            
<li >
    <a href="../../chapter4/exercise3/">4.3</a>
</li>

                        
                            
<li >
    <a href="../../chapter4/exercise4/">4.4</a>
</li>

                        
                            
<li >
    <a href="../../chapter4/exercise5/">4.5</a>
</li>

                        
                            
<li >
    <a href="../../chapter4/exercise6/">4.6</a>
</li>

                        
                            
<li >
    <a href="../../chapter4/exercise7/">4.7</a>
</li>

                        
                            
<li >
    <a href="../../chapter4/exercise8/">4.8</a>
</li>

                        
                            
<li >
    <a href="../../chapter4/exercise9/">4.9</a>
</li>

                        
                            
<li >
    <a href="../../chapter4/exercise10/">4.10</a>
</li>

                        
                            
<li >
    <a href="../../chapter4/exercise11/">4.11</a>
</li>

                        
                            
<li >
    <a href="../../chapter4/exercise12/">4.12</a>
</li>

                        
                            
<li >
    <a href="../../chapter4/exercise13/">4.13</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">5 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../chapter5/exercise1/">5.1</a>
</li>

                        
                            
<li >
    <a href="../../chapter5/exercise2/">5.2</a>
</li>

                        
                            
<li >
    <a href="../../chapter5/exercise3/">5.3</a>
</li>

                        
                            
<li >
    <a href="../../chapter5/exercise4/">5.4</a>
</li>

                        
                            
<li >
    <a href="../../chapter5/exercise5/">5.5</a>
</li>

                        
                            
<li >
    <a href="../../chapter5/exercise6/">5.6</a>
</li>

                        
                            
<li >
    <a href="../../chapter5/exercise7/">5.7</a>
</li>

                        
                            
<li >
    <a href="../../chapter5/exercise8/">5.8</a>
</li>

                        
                            
<li >
    <a href="../../chapter5/exercise9/">5.9</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">6 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../chapter6/exercise1/">6.1</a>
</li>

                        
                            
<li >
    <a href="../../chapter6/exercise2/">6.2</a>
</li>

                        
                            
<li >
    <a href="../../chapter6/exercise3/">6.3</a>
</li>

                        
                            
<li >
    <a href="../../chapter6/exercise4/">6.4</a>
</li>

                        
                            
<li >
    <a href="../../chapter6/exercise5/">6.5</a>
</li>

                        
                            
<li >
    <a href="../../chapter6/exercise6/">6.6</a>
</li>

                        
                            
<li >
    <a href="../../chapter6/exercise7/">6.7</a>
</li>

                        
                            
<li >
    <a href="../../chapter6/exercise8/">6.8</a>
</li>

                        
                            
<li >
    <a href="../../chapter6/exercise9/">6.9</a>
</li>

                        
                            
<li >
    <a href="../../chapter6/exercise10/">6.10</a>
</li>

                        
                            
<li >
    <a href="../../chapter6/exercise11/">6.11</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">7 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../exercise1/">7.1</a>
</li>

                        
                            
<li >
    <a href="../exercise2/">7.2</a>
</li>

                        
                            
<li >
    <a href="../exercise3/">7.3</a>
</li>

                        
                            
<li >
    <a href="../exercise4/">7.4</a>
</li>

                        
                            
<li >
    <a href="../exercise5/">7.5</a>
</li>

                        
                            
<li >
    <a href="../exercise6/">7.6</a>
</li>

                        
                            
<li >
    <a href="../exercise7/">7.7</a>
</li>

                        
                            
<li class="active">
    <a href="./">7.8</a>
</li>

                        
                            
<li >
    <a href="../exercise9/">7.9</a>
</li>

                        
                            
<li >
    <a href="../exercise10/">7.10</a>
</li>

                        
                            
<li >
    <a href="../exercise11/">7.11</a>
</li>

                        
                            
<li >
    <a href="../exercise12/">7.12</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">8 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../chapter8/exercise1/">8.1</a>
</li>

                        
                            
<li >
    <a href="../../chapter8/exercise2/">8.2</a>
</li>

                        
                            
<li >
    <a href="../../chapter8/exercise3/">8.3</a>
</li>

                        
                            
<li >
    <a href="../../chapter8/exercise4/">8.4</a>
</li>

                        
                            
<li >
    <a href="../../chapter8/exercise5/">8.5</a>
</li>

                        
                            
<li >
    <a href="../../chapter8/exercise6/">8.6</a>
</li>

                        
                            
<li >
    <a href="../../chapter8/exercise7/">8.7</a>
</li>

                        
                            
<li >
    <a href="../../chapter8/exercise8/">8.8</a>
</li>

                        
                            
<li >
    <a href="../../chapter8/exercise9/">8.9</a>
</li>

                        
                            
<li >
    <a href="../../chapter8/exercise10/">8.10</a>
</li>

                        
                            
<li >
    <a href="../../chapter8/exercise11/">8.11</a>
</li>

                        
                            
<li >
    <a href="../../chapter8/exercise12/">8.12</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">9 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../chapter9/exercise1/">9.1</a>
</li>

                        
                            
<li >
    <a href="../../chapter9/exercise2/">9.2</a>
</li>

                        
                            
<li >
    <a href="../../chapter9/exercise3/">9.3</a>
</li>

                        
                            
<li >
    <a href="../../chapter9/exercise4/">9.4</a>
</li>

                        
                            
<li >
    <a href="../../chapter9/exercise5/">9.5</a>
</li>

                        
                            
<li >
    <a href="../../chapter9/exercise6/">9.6</a>
</li>

                        
                            
<li >
    <a href="../../chapter9/exercise7/">9.7</a>
</li>

                        
                            
<li >
    <a href="../../chapter9/exercise8/">9.8</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">10 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../chapter10/exercise1/">10.1</a>
</li>

                        
                            
<li >
    <a href="../../chapter10/exercise2/">10.2</a>
</li>

                        
                            
<li >
    <a href="../../chapter10/exercise3/">10.3</a>
</li>

                        
                            
<li >
    <a href="../../chapter10/exercise4/">10.4</a>
</li>

                        
                            
<li >
    <a href="../../chapter10/exercise5/">10.5</a>
</li>

                        
                            
<li >
    <a href="../../chapter10/exercise6/">10.6</a>
</li>

                        
                            
<li >
    <a href="../../chapter10/exercise7/">10.7</a>
</li>

                        
                            
<li >
    <a href="../../chapter10/exercise8/">10.8</a>
</li>

                        
                            
<li >
    <a href="../../chapter10/exercise9/">10.9</a>
</li>

                        
                            
<li >
    <a href="../../chapter10/exercise10/">10.10</a>
</li>

                        
                            
<li >
    <a href="../../chapter10/exercise11/">10.11</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../../../about/">About</a>
                    </li>
                
                
                </ul>

            <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                            <i class="fa fa-search"></i> Search
                        </a>
                    </li>
                    <li >
                        <a rel="next" href="../exercise7/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../exercise9/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="first-level active"><a href="#exercise-78">Exercise 7.8</a></li>
        <li class="first-level "><a href="#pre-processing-data">Pre-processing data</a></li>
        <li class="first-level "><a href="#relationships-analysis">Relationships analysis</a></li>
        <li class="first-level "><a href="#non-linear-models">Non-linear models</a></li>
            <li class="second-level"><a href="#polynomial-regression">Polynomial regression</a></li>
                
            <li class="second-level"><a href="#step-function">Step function</a></li>
                
            <li class="second-level"><a href="#regression-splines">Regression splines</a></li>
                
        <li class="first-level "><a href="#notes">Notes</a></li>
        <li class="first-level "><a href="#references">References</a></li>
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="exercise-78">Exercise 7.8</h1>
<pre><code class="python">import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from sklearn.pipeline import Pipeline
from sklearn.preprocessing import PolynomialFeatures
from sklearn.model_selection import cross_val_score
from sklearn.linear_model import LinearRegression
from patsy import dmatrix

%matplotlib inline
</code></pre>

<pre><code class="python">df = pd.read_csv('../data/Auto.csv')
</code></pre>

<pre><code class="python"># Visualize dataset
df.head()
</code></pre>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mpg</th>
      <th>cylinders</th>
      <th>displacement</th>
      <th>horsepower</th>
      <th>weight</th>
      <th>acceleration</th>
      <th>year</th>
      <th>origin</th>
      <th>name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>18.0</td>
      <td>8</td>
      <td>307.0</td>
      <td>130</td>
      <td>3504</td>
      <td>12.0</td>
      <td>70</td>
      <td>1</td>
      <td>chevrolet chevelle malibu</td>
    </tr>
    <tr>
      <th>1</th>
      <td>15.0</td>
      <td>8</td>
      <td>350.0</td>
      <td>165</td>
      <td>3693</td>
      <td>11.5</td>
      <td>70</td>
      <td>1</td>
      <td>buick skylark 320</td>
    </tr>
    <tr>
      <th>2</th>
      <td>18.0</td>
      <td>8</td>
      <td>318.0</td>
      <td>150</td>
      <td>3436</td>
      <td>11.0</td>
      <td>70</td>
      <td>1</td>
      <td>plymouth satellite</td>
    </tr>
    <tr>
      <th>3</th>
      <td>16.0</td>
      <td>8</td>
      <td>304.0</td>
      <td>150</td>
      <td>3433</td>
      <td>12.0</td>
      <td>70</td>
      <td>1</td>
      <td>amc rebel sst</td>
    </tr>
    <tr>
      <th>4</th>
      <td>17.0</td>
      <td>8</td>
      <td>302.0</td>
      <td>140</td>
      <td>3449</td>
      <td>10.5</td>
      <td>70</td>
      <td>1</td>
      <td>ford torino</td>
    </tr>
  </tbody>
</table>
</div>

<h1 id="pre-processing-data">Pre-processing data</h1>
<pre><code class="python"># 'horsepower' is a string
# We would like it to be a integer, in order to appear in scatter plots.
type(df['horsepower'][0])
</code></pre>

<pre><code>str
</code></pre>
<pre><code class="python"># 'horsepower' is a string because one of its values is '?'
df['horsepower'].unique()
</code></pre>

<pre><code>array(['130', '165', '150', '140', '198', '220', '215', '225', '190',
       '170', '160', '95', '97', '85', '88', '46', '87', '90', '113',
       '200', '210', '193', '?', '100', '105', '175', '153', '180', '110',
       '72', '86', '70', '76', '65', '69', '60', '80', '54', '208', '155',
       '112', '92', '145', '137', '158', '167', '94', '107', '230', '49',
       '75', '91', '122', '67', '83', '78', '52', '61', '93', '148', '129',
       '96', '71', '98', '115', '53', '81', '79', '120', '152', '102',
       '108', '68', '58', '149', '89', '63', '48', '66', '139', '103',
       '125', '133', '138', '135', '142', '77', '62', '132', '84', '64',
       '74', '116', '82'], dtype=object)
</code></pre>
<pre><code class="python"># Replace '?' value by zero
df['horsepower'] = df['horsepower'].replace(to_replace = '?', value = '0')
df['horsepower'].unique()  # Check if it's ok
</code></pre>

<pre><code>array(['130', '165', '150', '140', '198', '220', '215', '225', '190',
       '170', '160', '95', '97', '85', '88', '46', '87', '90', '113',
       '200', '210', '193', '0', '100', '105', '175', '153', '180', '110',
       '72', '86', '70', '76', '65', '69', '60', '80', '54', '208', '155',
       '112', '92', '145', '137', '158', '167', '94', '107', '230', '49',
       '75', '91', '122', '67', '83', '78', '52', '61', '93', '148', '129',
       '96', '71', '98', '115', '53', '81', '79', '120', '152', '102',
       '108', '68', '58', '149', '89', '63', '48', '66', '139', '103',
       '125', '133', '138', '135', '142', '77', '62', '132', '84', '64',
       '74', '116', '82'], dtype=object)
</code></pre>
<pre><code class="python"># Convert 'horsepower' to int
df['horsepower'] = df['horsepower'].astype(int)
type(df['horsepower'][0])  # Check if it's ok
</code></pre>

<pre><code>numpy.int32
</code></pre>
<h1 id="relationships-analysis">Relationships analysis</h1>
<pre><code class="python"># Scatterplot matrix using Seaborn
sns.pairplot(df);
</code></pre>

<p><img alt="png" src="../07_08_files/07_08_10_0.png" /></p>
<p><em>mpg</em> seems to have a non-linear relationship with: <em>displacement</em>, <em>horsepower</em> and <em>weight</em>. Since in the book they compare <em>mpg</em> to <em>horsepower</em>, we will only analyse that relationship in this exercise.</p>
<h1 id="non-linear-models">Non-linear models</h1>
<p>Non-linear models investigated in Chapter 7:
<em> Polynomial regression
</em> Step function
<em> Regression splines
</em> Smoothing splines
<em> Local regression
</em> Generalized additive models (GAM)</p>
<p>We will develop models for the first three because we didn't find functions for smoothing splines, local regression and GAM.</p>
<pre><code class="python"># Dataset
X = df['horsepower'][:,np.newaxis]
y = df['mpg']
</code></pre>

<h2 id="polynomial-regression">Polynomial regression</h2>
<pre><code class="python">for i in range (1,11):
    model = Pipeline([('poly', PolynomialFeatures(degree=i)), 
                      ('linear', LinearRegression())])
    model.fit(X,y)

    score = cross_val_score(model, X, y, cv=5, scoring='neg_mean_squared_error')

    print(&quot;Degree: %i  CV mean squared error: %.3f&quot; % (i, np.mean(np.abs(score))))
</code></pre>

<pre><code>Degree: 1  CV mean squared error: 32.573
Degree: 2  CV mean squared error: 30.515
Degree: 3  CV mean squared error: 27.440
Degree: 4  CV mean squared error: 25.396
Degree: 5  CV mean squared error: 24.986
Degree: 6  CV mean squared error: 24.937
Degree: 7  CV mean squared error: 24.831
Degree: 8  CV mean squared error: 24.907
Degree: 9  CV mean squared error: 25.358
Degree: 10  CV mean squared error: 25.270
</code></pre>
<p>The polynomial degree that best fits the relationship between <em>mpg</em> and <em>horsepower</em> is <b>7</b>.</p>
<h2 id="step-function">Step function</h2>
<pre><code class="python">for i in range(1,11):
    groups = pd.cut(df['horsepower'], i)
    df_dummies = pd.get_dummies(groups)

    X_step = df_dummies
    y_step = df['mpg']

    model.fit(X_step, y_step)
    score = cross_val_score(model, X_step, y_step, cv=5, scoring='neg_mean_squared_error')

    print('Number of cuts: %i  CV mean squared error: %.3f' %(i, np.mean(np.abs(score))))
</code></pre>

<pre><code>Number of cuts: 1  CV mean squared error: 74.402
Number of cuts: 2  CV mean squared error: 43.120
Number of cuts: 3  CV mean squared error: 36.934
Number of cuts: 4  CV mean squared error: 41.236
Number of cuts: 5  CV mean squared error: 30.880
Number of cuts: 6  CV mean squared error: 29.083
Number of cuts: 7  CV mean squared error: 29.269
Number of cuts: 8  CV mean squared error: 28.562
Number of cuts: 9  CV mean squared error: 27.776
Number of cuts: 10  CV mean squared error: 24.407
</code></pre>
<p>The step function that best fits the relationship between <em>mpg</em> and <em>horsepower</em> is the one with <b>10</b> steps.</p>
<h2 id="regression-splines">Regression splines</h2>
<p>There are two types of regression splines: splines and natural splines. The difference between these two groups is that a natural spline is a regression spline with additional boundary constraints: the natural function is required to be linear at the boundary. This additional constraint means that natural splines generally produce more stable estimates at the boundaries.</p>
<p>Usually, cubic splines are used. These splines are popular because most human eyes cannot detect the discontinuity at the knots. We use both cubic and natural cubic splines in this exercise.</p>
<p>To generate split basis representation, the package <em>patsy</em> is used. <em>patsy</em> is a Python package for describing statistical models (especially linear models, or models that have a linear component). Check the References for more details.</p>
<p><b> Cubic splines</p>
<pre><code class="python">for i in range(3,11):  # The degrees of freedom can't be less than 3 in a cubic spline
    transformed = dmatrix(&quot;bs(df.horsepower, df=%i, degree=3)&quot; % i,
                         {&quot;df.horsepower&quot;:df.horsepower},
                          return_type='dataframe')  # Cubic spline basis representation
    lin = LinearRegression()
    lin.fit(transformed, y)

    score = cross_val_score(lin, transformed, y, cv=10, scoring='neg_mean_squared_error')

    print('Number of degrees of freedom: %i  CV mean squared error: %.3f' %(i, np.mean(np.abs(score))))
</code></pre>

<pre><code>Number of degrees of freedom: 3  CV mean squared error: 24.268
Number of degrees of freedom: 4  CV mean squared error: 22.195
Number of degrees of freedom: 5  CV mean squared error: 22.319
Number of degrees of freedom: 6  CV mean squared error: 22.028
Number of degrees of freedom: 7  CV mean squared error: 22.099
Number of degrees of freedom: 8  CV mean squared error: 22.145
Number of degrees of freedom: 9  CV mean squared error: 21.783
Number of degrees of freedom: 10  CV mean squared error: 21.965
</code></pre>
<p><b> Natural cubic splines</p>
<pre><code class="python">for i in range(3,11):  # The degrees of freedom can't be less than 3 in a cubic spline
    transformed = dmatrix(&quot;cr(df.horsepower, df=%i)&quot; % i,
                         {&quot;df.horsepower&quot;:df.horsepower},
                          return_type='dataframe')  # Cubic spline basis representation
    lin = LinearRegression()
    lin.fit(transformed, y)

    score = cross_val_score(lin, transformed, y, cv=10, scoring='neg_mean_squared_error')

    print('Number of degrees of freedom: %i  CV mean squared error: %.3f' %(i, np.mean(np.abs(score))))
</code></pre>

<pre><code>Number of degrees of freedom: 3  CV mean squared error: 27.132
Number of degrees of freedom: 4  CV mean squared error: 24.297
Number of degrees of freedom: 5  CV mean squared error: 22.317
Number of degrees of freedom: 6  CV mean squared error: 21.721
Number of degrees of freedom: 7  CV mean squared error: 21.904
Number of degrees of freedom: 8  CV mean squared error: 22.019
Number of degrees of freedom: 9  CV mean squared error: 21.926
Number of degrees of freedom: 10  CV mean squared error: 22.201
</code></pre>
<p>The regression spline that best fits the relationship between <em>mpg</em> and <em>horsepower</em> is a <b>natural cubic spline</b> with <b>6</b> degrees of freedom. This is also the model that gives the best results of the three considered in this exercise.</p>
<p><b>Notes regarding regression splines:</b>
<em> In practice it is common to specify the desired degrees of freedom, and then have the software automatically place the corresponding number of knots at uniform quantiles of the data. This way, knots are placed in a uniform fashion.
</em> Knowing the degrees of freedom (df), we can know the number of knots (K). If it is a cubic spline, we have <em>df = 4 + K</em>. If it is a natural cubic spline, we have <em>df = K</em> because there are two additional natural constraints at each boundary to enforce linearity. However, regarding natural cubic splines, different interpretations can be made. For example, it can be said that <em>df = K - 1</em> because it includes a constant that is absorbed in the intercept, so we can count only <em>K-1</em> degrees of freedom.
* Cross-validation is an objective approach to define how many degrees of freedom our spline should contain.  </p>
<h1 id="notes">Notes</h1>
<ul>
<li>Solved exercises use <em>displacement</em> instead of <em>horsepower</em>, so I couldn't verify my solutions. I only found one set of solved exercises for this exercise.</li>
<li>According to https://github.com/JWarmenhoven/ISLR-python/blob/master/Notebooks/Chapter%207.ipynb, Python does not have functions to create smoothing splines, local regression or GAMs.</li>
</ul>
<h1 id="references">References</h1>
<ul>
<li>Introduction to Statistical Learning with R, Chapter 3.3</li>
<li>http://www.science.smith.edu/~jcrouser/SDS293/labs/lab13/Lab%2013%20-%20Splines%20in%20Python.pdf</li>
<li>https://github.com/JWarmenhoven/ISLR-python/blob/master/Notebooks/Chapter%207.ipynb</li>
<li>http://patsy.readthedocs.io/en/latest/API-reference.html (search for: 'patsy.cr')</li>
</ul></div>
        
    </div>

    <footer class="col-md-12 text-center">
        <hr>
        <p>
        <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p></small>
    </footer>

    <script src="../../../js/jquery-1.10.2.min.js"></script>
    <script src="../../../js/bootstrap-3.0.3.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>
    var base_url = '../../..';
    </script>
    <script data-main="../../../mkdocs/js/search.js" src="../../../mkdocs/js/require.js"></script>
    <script src="../../../js/base.js"></script>
    <script src="../../../mathjax-config.js"></script>
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="../../../search/require.js"></script>
    <script src="../../../search/search.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    </body>

</html>
