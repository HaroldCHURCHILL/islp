<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">   
    <link rel="shortcut icon" href="../../../img/favicon.ico">

    <title></title>

    <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.018/css/hack.min.css">
    <link href='//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../../../css/base.css" rel="stylesheet">
    <link href="../../../css/cinder.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->

            <a class="navbar-brand" href="../../..">Statistical Learning with Python</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../../..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">2 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../chapter2/exercise1/">2.1</a>
</li>

                        
                            
<li >
    <a href="../../chapter2/exercise2/">2.2</a>
</li>

                        
                            
<li >
    <a href="../../chapter2/exercise3/">2.3</a>
</li>

                        
                            
<li >
    <a href="../../chapter2/exercise4/">2.4</a>
</li>

                        
                            
<li >
    <a href="../../chapter2/exercise5/">2.5</a>
</li>

                        
                            
<li >
    <a href="../../chapter2/exercise6/">2.6</a>
</li>

                        
                            
<li >
    <a href="../../chapter2/exercise7/">2.7</a>
</li>

                        
                            
<li >
    <a href="../../chapter2/exercise8/">2.8</a>
</li>

                        
                            
<li >
    <a href="../../chapter2/exercise9/">2.9</a>
</li>

                        
                            
<li >
    <a href="../../chapter2/exercise10/">2.10</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">3 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../exercise1/">3.1</a>
</li>

                        
                            
<li >
    <a href="../exercise2/">3.2</a>
</li>

                        
                            
<li >
    <a href="../exercise3/">3.3</a>
</li>

                        
                            
<li >
    <a href="../exercise4/">3.4</a>
</li>

                        
                            
<li >
    <a href="../exercise5/">3.5</a>
</li>

                        
                            
<li >
    <a href="../exercise6/">3.6</a>
</li>

                        
                            
<li >
    <a href="../exercise7/">3.7</a>
</li>

                        
                            
<li class="active">
    <a href="./">3.8</a>
</li>

                        
                            
<li >
    <a href="../exercise9/">3.9</a>
</li>

                        
                            
<li >
    <a href="../exercise10/">3.10</a>
</li>

                        
                            
<li >
    <a href="../exercise11/">3.11</a>
</li>

                        
                            
<li >
    <a href="../exercise12/">3.12</a>
</li>

                        
                            
<li >
    <a href="../exercise13/">3.13</a>
</li>

                        
                            
<li >
    <a href="../exercise14/">3.14</a>
</li>

                        
                            
<li >
    <a href="../exercise15/">3.15</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">4 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../chapter4/exercise1/">4.1</a>
</li>

                        
                            
<li >
    <a href="../../chapter4/exercise2/">4.2</a>
</li>

                        
                            
<li >
    <a href="../../chapter4/exercise3/">4.3</a>
</li>

                        
                            
<li >
    <a href="../../chapter4/exercise4/">4.4</a>
</li>

                        
                            
<li >
    <a href="../../chapter4/exercise5/">4.5</a>
</li>

                        
                            
<li >
    <a href="../../chapter4/exercise6/">4.6</a>
</li>

                        
                            
<li >
    <a href="../../chapter4/exercise7/">4.7</a>
</li>

                        
                            
<li >
    <a href="../../chapter4/exercise8/">4.8</a>
</li>

                        
                            
<li >
    <a href="../../chapter4/exercise9/">4.9</a>
</li>

                        
                            
<li >
    <a href="../../chapter4/exercise10/">4.10</a>
</li>

                        
                            
<li >
    <a href="../../chapter4/exercise11/">4.11</a>
</li>

                        
                            
<li >
    <a href="../../chapter4/exercise12/">4.12</a>
</li>

                        
                            
<li >
    <a href="../../chapter4/exercise13/">4.13</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">5 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../chapter5/exercise1/">5.1</a>
</li>

                        
                            
<li >
    <a href="../../chapter5/exercise2/">5.2</a>
</li>

                        
                            
<li >
    <a href="../../chapter5/exercise3/">5.3</a>
</li>

                        
                            
<li >
    <a href="../../chapter5/exercise4/">5.4</a>
</li>

                        
                            
<li >
    <a href="../../chapter5/exercise5/">5.5</a>
</li>

                        
                            
<li >
    <a href="../../chapter5/exercise6/">5.6</a>
</li>

                        
                            
<li >
    <a href="../../chapter5/exercise7/">5.7</a>
</li>

                        
                            
<li >
    <a href="../../chapter5/exercise8/">5.8</a>
</li>

                        
                            
<li >
    <a href="../../chapter5/exercise9/">5.9</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">6 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../chapter6/exercise1/">6.1</a>
</li>

                        
                            
<li >
    <a href="../../chapter6/exercise2/">6.2</a>
</li>

                        
                            
<li >
    <a href="../../chapter6/exercise3/">6.3</a>
</li>

                        
                            
<li >
    <a href="../../chapter6/exercise4/">6.4</a>
</li>

                        
                            
<li >
    <a href="../../chapter6/exercise5/">6.5</a>
</li>

                        
                            
<li >
    <a href="../../chapter6/exercise6/">6.6</a>
</li>

                        
                            
<li >
    <a href="../../chapter6/exercise7/">6.7</a>
</li>

                        
                            
<li >
    <a href="../../chapter6/exercise8/">6.8</a>
</li>

                        
                            
<li >
    <a href="../../chapter6/exercise9/">6.9</a>
</li>

                        
                            
<li >
    <a href="../../chapter6/exercise10/">6.10</a>
</li>

                        
                            
<li >
    <a href="../../chapter6/exercise11/">6.11</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">7 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../chapter7/exercise1/">7.1</a>
</li>

                        
                            
<li >
    <a href="../../chapter7/exercise2/">7.2</a>
</li>

                        
                            
<li >
    <a href="../../chapter7/exercise3/">7.3</a>
</li>

                        
                            
<li >
    <a href="../../chapter7/exercise4/">7.4</a>
</li>

                        
                            
<li >
    <a href="../../chapter7/exercise5/">7.5</a>
</li>

                        
                            
<li >
    <a href="../../chapter7/exercise6/">7.6</a>
</li>

                        
                            
<li >
    <a href="../../chapter7/exercise7/">7.7</a>
</li>

                        
                            
<li >
    <a href="../../chapter7/exercise8/">7.8</a>
</li>

                        
                            
<li >
    <a href="../../chapter7/exercise9/">7.9</a>
</li>

                        
                            
<li >
    <a href="../../chapter7/exercise10/">7.10</a>
</li>

                        
                            
<li >
    <a href="../../chapter7/exercise11/">7.11</a>
</li>

                        
                            
<li >
    <a href="../../chapter7/exercise12/">7.12</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">8 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../chapter8/exercise1/">8.1</a>
</li>

                        
                            
<li >
    <a href="../../chapter8/exercise2/">8.2</a>
</li>

                        
                            
<li >
    <a href="../../chapter8/exercise3/">8.3</a>
</li>

                        
                            
<li >
    <a href="../../chapter8/exercise4/">8.4</a>
</li>

                        
                            
<li >
    <a href="../../chapter8/exercise5/">8.5</a>
</li>

                        
                            
<li >
    <a href="../../chapter8/exercise6/">8.6</a>
</li>

                        
                            
<li >
    <a href="../../chapter8/exercise7/">8.7</a>
</li>

                        
                            
<li >
    <a href="../../chapter8/exercise8/">8.8</a>
</li>

                        
                            
<li >
    <a href="../../chapter8/exercise9/">8.9</a>
</li>

                        
                            
<li >
    <a href="../../chapter8/exercise10/">8.10</a>
</li>

                        
                            
<li >
    <a href="../../chapter8/exercise11/">8.11</a>
</li>

                        
                            
<li >
    <a href="../../chapter8/exercise12/">8.12</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">9 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../chapter9/exercise1/">9.1</a>
</li>

                        
                            
<li >
    <a href="../../chapter9/exercise2/">9.2</a>
</li>

                        
                            
<li >
    <a href="../../chapter9/exercise3/">9.3</a>
</li>

                        
                            
<li >
    <a href="../../chapter9/exercise4/">9.4</a>
</li>

                        
                            
<li >
    <a href="../../chapter9/exercise5/">9.5</a>
</li>

                        
                            
<li >
    <a href="../../chapter9/exercise6/">9.6</a>
</li>

                        
                            
<li >
    <a href="../../chapter9/exercise7/">9.7</a>
</li>

                        
                            
<li >
    <a href="../../chapter9/exercise8/">9.8</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">10 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../chapter10/exercise1/">10.1</a>
</li>

                        
                            
<li >
    <a href="../../chapter10/exercise2/">10.2</a>
</li>

                        
                            
<li >
    <a href="../../chapter10/exercise3/">10.3</a>
</li>

                        
                            
<li >
    <a href="../../chapter10/exercise4/">10.4</a>
</li>

                        
                            
<li >
    <a href="../../chapter10/exercise5/">10.5</a>
</li>

                        
                            
<li >
    <a href="../../chapter10/exercise6/">10.6</a>
</li>

                        
                            
<li >
    <a href="../../chapter10/exercise7/">10.7</a>
</li>

                        
                            
<li >
    <a href="../../chapter10/exercise8/">10.8</a>
</li>

                        
                            
<li >
    <a href="../../chapter10/exercise9/">10.9</a>
</li>

                        
                            
<li >
    <a href="../../chapter10/exercise10/">10.10</a>
</li>

                        
                            
<li >
    <a href="../../chapter10/exercise11/">10.11</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../../../about/">About</a>
                    </li>
                
                
                </ul>

            <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                            <i class="fa fa-search"></i> Search
                        </a>
                    </li>
                    <li >
                        <a rel="next" href="../exercise7/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../exercise9/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="first-level active"><a href="#exercise-38">Exercise 3.8</a></li>
            <li class="second-level"><a href="#a">(a)</a></li>
                
                <li class="third-level"><a href="#i">i.</a></li>
                <li class="third-level"><a href="#ii">ii</a></li>
                <li class="third-level"><a href="#iii">iii</a></li>
                <li class="third-level"><a href="#iv">iv</a></li>
                <li class="third-level"><a href="#references">References</a></li>
            <li class="second-level"><a href="#b">(b)</a></li>
                
            <li class="second-level"><a href="#c">(c)</a></li>
                
                <li class="third-level"><a href="#residuals-against-fitted-values">Residuals against fitted values</a></li>
                <li class="third-level"><a href="#normal-q-q-plot">Normal Q-Q plot</a></li>
                <li class="third-level"><a href="#scale-location-plot-of-sqrtresiduals-against-fitted-values">Scale-Location plot of sqrt(|residuals|) against fitted values</a></li>
                <li class="third-level"><a href="#residuals-against-leverages">Residuals against leverages</a></li>
                <li class="third-level"><a href="#references_1">References</a></li>
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="exercise-38">Exercise 3.8</h1>
<pre><code class="python">import pandas as pd
import numpy as np
import seaborn as sns
import matplotlib.pyplot as plt
import statsmodels.formula.api as smf  # Statsmodels is a Python module for statistics
import statsmodels.api as sm

%matplotlib inline
</code></pre>

<pre><code class="python">df = pd.read_csv('../data/auto.csv') # import dataset
</code></pre>

<pre><code class="python">df.head() # just to have a look
</code></pre>

<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mpg</th>
      <th>cylinders</th>
      <th>displacement</th>
      <th>horsepower</th>
      <th>weight</th>
      <th>acceleration</th>
      <th>year</th>
      <th>origin</th>
      <th>name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>18.0</td>
      <td>8</td>
      <td>307.0</td>
      <td>130</td>
      <td>3504</td>
      <td>12.0</td>
      <td>70</td>
      <td>1</td>
      <td>chevrolet chevelle malibu</td>
    </tr>
    <tr>
      <th>1</th>
      <td>15.0</td>
      <td>8</td>
      <td>350.0</td>
      <td>165</td>
      <td>3693</td>
      <td>11.5</td>
      <td>70</td>
      <td>1</td>
      <td>buick skylark 320</td>
    </tr>
    <tr>
      <th>2</th>
      <td>18.0</td>
      <td>8</td>
      <td>318.0</td>
      <td>150</td>
      <td>3436</td>
      <td>11.0</td>
      <td>70</td>
      <td>1</td>
      <td>plymouth satellite</td>
    </tr>
    <tr>
      <th>3</th>
      <td>16.0</td>
      <td>8</td>
      <td>304.0</td>
      <td>150</td>
      <td>3433</td>
      <td>12.0</td>
      <td>70</td>
      <td>1</td>
      <td>amc rebel sst</td>
    </tr>
    <tr>
      <th>4</th>
      <td>17.0</td>
      <td>8</td>
      <td>302.0</td>
      <td>140</td>
      <td>3449</td>
      <td>10.5</td>
      <td>70</td>
      <td>1</td>
      <td>ford torino</td>
    </tr>
  </tbody>
</table>
</div>

<h2 id="a">(a)</h2>
<pre><code class="python"># prepare data for modelling (training set)
X_train = df['horsepower'] # horsepower as predictor
y_train = df['mpg']        # mpg as response
</code></pre>

<pre><code class="python">X_train.head() # just to check
</code></pre>

<pre><code>0    130
1    165
2    150
3    150
4    140
Name: horsepower, dtype: object
</code></pre>
<pre><code class="python">y_train.head() # just to check
</code></pre>

<pre><code>0    18.0
1    15.0
2    18.0
3    16.0
4    17.0
Name: mpg, dtype: float64
</code></pre>
<pre><code class="python">X_train.unique() # check for data quality (missing data, errors, etc.)
</code></pre>

<pre><code>array(['130', '165', '150', '140', '198', '220', '215', '225', '190',
       '170', '160', '95', '97', '85', '88', '46', '87', '90', '113',
       '200', '210', '193', '?', '100', '105', '175', '153', '180', '110',
       '72', '86', '70', '76', '65', '69', '60', '80', '54', '208', '155',
       '112', '92', '145', '137', '158', '167', '94', '107', '230', '49',
       '75', '91', '122', '67', '83', '78', '52', '61', '93', '148', '129',
       '96', '71', '98', '115', '53', '81', '79', '120', '152', '102',
       '108', '68', '58', '149', '89', '63', '48', '66', '139', '103',
       '125', '133', '138', '135', '142', '77', '62', '132', '84', '64',
       '74', '116', '82'], dtype=object)
</code></pre>
<ul>
<li>There is a strange value: <strong>'?'</strong></li>
</ul>
<pre><code class="python"># handling with '?' observations (delete them)
droplist = X_train[X_train == '?'].index # get index of observations with '?' value
X_train = X_train.drop(droplist)         # drop those observations
y_train = y_train.drop(droplist)         # ensure dimensional compatibility between variables
X_train.unique()                         # test
</code></pre>

<pre><code>array(['130', '165', '150', '140', '198', '220', '215', '225', '190',
       '170', '160', '95', '97', '85', '88', '46', '87', '90', '113',
       '200', '210', '193', '100', '105', '175', '153', '180', '110', '72',
       '86', '70', '76', '65', '69', '60', '80', '54', '208', '155', '112',
       '92', '145', '137', '158', '167', '94', '107', '230', '49', '75',
       '91', '122', '67', '83', '78', '52', '61', '93', '148', '129', '96',
       '71', '98', '115', '53', '81', '79', '120', '152', '102', '108',
       '68', '58', '149', '89', '63', '48', '66', '139', '103', '125',
       '133', '138', '135', '142', '77', '62', '132', '84', '64', '74',
       '116', '82'], dtype=object)
</code></pre>
<pre><code class="python">y_train.unique() # check for data quality (missing data, errors, etc.)
</code></pre>

<pre><code>array([ 18. ,  15. ,  16. ,  17. ,  14. ,  24. ,  22. ,  21. ,  27. ,
        26. ,  25. ,  10. ,  11. ,   9. ,  28. ,  19. ,  12. ,  13. ,
        23. ,  30. ,  31. ,  35. ,  20. ,  29. ,  32. ,  33. ,  17.5,
        15.5,  14.5,  22.5,  24.5,  18.5,  29.5,  26.5,  16.5,  31.5,
        36. ,  25.5,  33.5,  20.5,  30.5,  21.5,  43.1,  36.1,  32.8,
        39.4,  19.9,  19.4,  20.2,  19.2,  25.1,  20.6,  20.8,  18.6,
        18.1,  17.7,  27.5,  27.2,  30.9,  21.1,  23.2,  23.8,  23.9,
        20.3,  21.6,  16.2,  19.8,  22.3,  17.6,  18.2,  16.9,  31.9,
        34.1,  35.7,  27.4,  25.4,  34.2,  34.5,  31.8,  37.3,  28.4,
        28.8,  26.8,  41.5,  38.1,  32.1,  37.2,  26.4,  24.3,  19.1,
        34.3,  29.8,  31.3,  37. ,  32.2,  46.6,  27.9,  40.8,  44.3,
        43.4,  36.4,  44.6,  33.8,  32.7,  23.7,  32.4,  26.6,  25.8,
        23.5,  39.1,  39. ,  35.1,  32.3,  37.7,  34.7,  34.4,  29.9,
        33.7,  32.9,  31.6,  28.1,  30.7,  24.2,  22.4,  34. ,  38. ,  44. ])
</code></pre>
<pre><code class="python"># create dataframe to use statsmodel
d = {'horsepower':X_train.astype('float'), 'mpg':y_train}
df = pd.DataFrame(data=d)
df.head()
</code></pre>

<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>horsepower</th>
      <th>mpg</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>130.0</td>
      <td>18.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>165.0</td>
      <td>15.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>150.0</td>
      <td>18.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>150.0</td>
      <td>16.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>140.0</td>
      <td>17.0</td>
    </tr>
  </tbody>
</table>
</div>

<pre><code class="python"># plot
plt.scatter(X_train,y_train);
</code></pre>

<p><img alt="png" src="../03_08_files/03_08_13_0.png" /></p>
<pre><code class="python"># using statsmodel for linear regression (http://statsmodels.sourceforge.net/)
mod = smf.ols(formula='mpg ~ horsepower', data = df)
res = mod.fit()
print(res.summary())
</code></pre>

<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                    mpg   R-squared:                       0.606
Model:                            OLS   Adj. R-squared:                  0.605
Method:                 Least Squares   F-statistic:                     599.7
Date:                Fri, 08 Dec 2017   Prob (F-statistic):           7.03e-81
Time:                        09:48:30   Log-Likelihood:                -1178.7
No. Observations:                 392   AIC:                             2361.
Df Residuals:                     390   BIC:                             2369.
Df Model:                           1                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
Intercept     39.9359      0.717     55.660      0.000      38.525      41.347
horsepower    -0.1578      0.006    -24.489      0.000      -0.171      -0.145
==============================================================================
Omnibus:                       16.432   Durbin-Watson:                   0.920
Prob(Omnibus):                  0.000   Jarque-Bera (JB):               17.305
Skew:                           0.492   Prob(JB):                     0.000175
Kurtosis:                       3.299   Cond. No.                         322.
==============================================================================

Warnings:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</code></pre>
<h3 id="i">i.</h3>
<p>Yes, there is a relationship between the predictor and the response. We can reject the null hypothesis that the regression coefficients are zero, since the F-statistic is much larger than 1 and the p-value is close to zero.</p>
<h3 id="ii">ii</h3>
<p>Since the R-squared value is just about 0.606, we can say that approximately 60% of the variance in mpg is explained by horsepower.</p>
<h3 id="iii">iii</h3>
<p>The relationship is negative because the coefficient corresponding to horsepower is equal to -0.1578.</p>
<h3 id="iv">iv</h3>
<p>This exercise is a bit trickier to do in Python, since there's no standard out-of-the-box function for it (please let us know if you could find one). If we were solving this exercise in R, we would just need to use the functions confint() and predict() (see bottom of page 111 of ISLR). </p>
<p>On page 82 of ISLR, they describe the qualitative difference between a confidence and a prediction interval. However, the text does not explain how to calculate the intervals.
For a good description and derivation on how to calculate these intervals see Casella and Berger [1], section 11.3.5 ("Estimation and Prediction at a Specified x=x0"). 
The distinction between the two types of interval is also well laid out in the answer [2], adapted from section 4.1 of Faraway [3].</p>
<p>The answer is calculated below. 
The predicted 'mpg' is equal to 24.46708, with a 95% confidence interval of (23.97308, 24.96108) and a 95% prediction interval of (14.80940, 34.12476).
These are the same values as calculated with the R functions confint() and predict().</p>
<pre><code class="python"># this code follows Chapter 11 of Casella and Berger [1]
# below we comment the lines with the page numbers of the text where the corresponding formulas appear

from scipy.stats import t
from math import sqrt

def interval(x, y, x0,alpha = .05):
    n = np.size(x)
    x_bar = np.mean(x)
    y_bar = np.mean(y)
    S_xx = np.sum((x-x_bar)**2)         # page 541
    S_xy = np.sum((x-x_bar)*(y-y_bar))  # page 541
    b = S_xy/S_xx                       # page 542
    a = y_bar - b*x_bar                 # page 542
    S2 = np.sum((y-a-b*x)**2)/(n-2)     # page 552
    S = sqrt(S2)
    ts = t.ppf(1-alpha/2, n-2)
    w_conf = ts*S*sqrt(1/n + (x0-x_bar)**2/S_xx)      # page 558
    w_pred = ts*S*sqrt(1 + 1/n + (x0-x_bar)**2/S_xx)  # page 559
    print(&quot;                fit \t lwr \t  upr&quot;)
    print(&quot;confidence %3.5f %3.5f %3.5f&quot; % (a+b*x0, a+b*x0 - w_conf, a+b*x0 + w_conf))
    print(&quot;prediction %3.5f %3.5f %3.5f&quot; % (a+b*x0, a+b*x0 - w_pred, a+b*x0 + w_pred))

x = df['horsepower']
y = df['mpg']
x0 = 98    

interval(x, y, x0)
</code></pre>

<pre><code>                fit      lwr      upr
confidence 24.46708 23.97308 24.96108
prediction 24.46708 14.80940 34.12476
</code></pre>
<h3 id="references">References</h3>
<p>[1] Casella, George, and Roger L. Berger. Statistical inference. Vol. 2. Pacific Grove, CA: Duxbury, 2002. <a href="https://smile.amazon.com/Statistical-Inference-George-Casella/dp/0534243126">amazon</a></p>
<p>[2] <a href="https://stats.stackexchange.com/a/271232">https://stats.stackexchange.com/a/271232</a></p>
<p>[3] Faraway, Julian J. Linear models with R. CRC press, 2014.  <a href="https://smile.amazon.com/Linear-Models-Chapman-Statistical-Science/dp/1439887330">amazon</a></p>
<h2 id="b">(b)</h2>
<pre><code class="python">plt.subplots(1,1) #to get both plots in the same figure 
plt.scatter(X_train.astype('float'), y_train);
plt.plot(X_train.astype('float'), res.fittedvalues, color='red');
</code></pre>

<p><img alt="png" src="../03_08_files/03_08_26_0.png" /></p>
<h2 id="c">(c)</h2>
<p>In R [4], by default, plot() on a fit produces 4 plots: 
 * a plot of residuals against fitted values,
 * a Scale-Location plot of sqrt(| residuals |) against fitted values,
 * a Normal Q-Q plot,
 * a plot of residuals against leverages.</p>
<p>Below, we plot each of these 4 plots. We used the code published by Emre Can [5] with a few adaptations.</p>
<pre><code class="python">import statsmodels.formula.api as smf
from statsmodels.graphics.gofplots import ProbPlot

plt.style.use('seaborn') # pretty matplotlib plots
plt.rc('font', size=14)
plt.rc('figure', titlesize=18)
plt.rc('axes', labelsize=15)
plt.rc('axes', titlesize=18)

model_f = 'mpg ~ horsepower'

df.reset_index(drop=True, inplace=True)

model = smf.ols(formula=model_f, data=df)

model_fit = model.fit()

# fitted values (need a constant term for intercept)
model_fitted_y = model_fit.fittedvalues

# model residuals
model_residuals = model_fit.resid

# normalized residuals
model_norm_residuals = model_fit.get_influence().resid_studentized_internal

# absolute squared normalized residuals
model_norm_residuals_abs_sqrt = np.sqrt(np.abs(model_norm_residuals))

# absolute residuals
model_abs_resid = np.abs(model_residuals)

# leverage, from statsmodels internals
model_leverage = model_fit.get_influence().hat_matrix_diag

# cook's distance, from statsmodels internals
model_cooks = model_fit.get_influence().cooks_distance[0]
</code></pre>

<h3 id="residuals-against-fitted-values">Residuals against fitted values</h3>
<pre><code class="python">plot_lm_1 = plt.figure(1)
plot_lm_1.set_figheight(8)
plot_lm_1.set_figwidth(12)

plot_lm_1.axes[0] = sns.residplot(model_fitted_y, 'mpg', data=df,
                                  lowess=True,
                                  scatter_kws={'alpha': 0.5},
                                  line_kws={'color': 'red', 'lw': 1, 'alpha': 0.8})

plot_lm_1.axes[0].set_title('Residuals vs Fitted')
plot_lm_1.axes[0].set_xlabel('Fitted values')
plot_lm_1.axes[0].set_ylabel('Residuals')


# annotations
abs_resid = model_abs_resid.sort_values(ascending=False)
abs_resid_top_3 = abs_resid[:3]

for i in abs_resid_top_3.index:
    plot_lm_1.axes[0].annotate(i, 
                               xy=(model_fitted_y[i], 
                                   model_residuals[i]));
</code></pre>

<p><img alt="png" src="../03_08_files/03_08_31_0.png" /></p>
<p>The red line is a smooth fit to the residuals which helps to spot any trends. 
We can clearly see a strong non-linearity indicated by the curve of the red line.
Figure 3.9 of the text also comments on this and shows the same plot for a quadratical fit, where the this trend is now almost non-existant.
The funnel shape of the plotted residuals indicates that we are in the presence of heteroscedasticity. </p>
<h3 id="normal-q-q-plot">Normal Q-Q plot</h3>
<pre><code class="python">QQ = ProbPlot(model_norm_residuals)
plot_lm_2 = QQ.qqplot(line='45', alpha=0.5, color='#4C72B0', lw=1)

plot_lm_2.set_figheight(8)
plot_lm_2.set_figwidth(12)

plot_lm_2.axes[0].set_title('Normal Q-Q')
plot_lm_2.axes[0].set_xlabel('Theoretical Quantiles')
plot_lm_2.axes[0].set_ylabel('Standardized Residuals');

# annotations
abs_norm_resid = np.flip(np.argsort(np.abs(model_norm_residuals)), 0)
abs_norm_resid_top_3 = abs_norm_resid[:3]

for r, i in enumerate(abs_norm_resid_top_3):
    plot_lm_2.axes[0].annotate(i, 
                               xy=(np.flip(QQ.theoretical_quantiles, 0)[r],
                                   model_norm_residuals[i]));
</code></pre>

<p><img alt="png" src="../03_08_files/03_08_34_0.png" /></p>
<p>The qq-plot indicates that the assumption of normality does hold, since we can fit a straight line quite well, although there seems to be a slight left skew.</p>
<p>The links below provide nice explanations and intuitions of the concept of qq-plots and pp-plots and how to interpret them.</p>
<ul>
<li><a href="https://stats.stackexchange.com/questions/52212/qq-plot-does-not-match-histogram/52221#52221">https://stats.stackexchange.com/questions/52212/qq-plot-does-not-match-histogram/52221#52221</a></li>
<li>https://stats.stackexchange.com/questions/101274/how-to-interpret-a-qq-plot</li>
<li>https://xiongge.shinyapps.io/QQplots/</li>
<li>https://stats.stackexchange.com/questions/92141/pp-plots-vs-qq-plots/100383#100383</li>
</ul>
<h3 id="scale-location-plot-of-sqrtresiduals-against-fitted-values">Scale-Location plot of sqrt(|residuals|) against fitted values</h3>
<pre><code class="python">plot_lm_3 = plt.figure(3)
plot_lm_3.set_figheight(8)
plot_lm_3.set_figwidth(12)

plt.scatter(model_fitted_y, model_norm_residuals_abs_sqrt, alpha=0.5)
sns.regplot(model_fitted_y, model_norm_residuals_abs_sqrt, 
            scatter=False, 
            ci=False, 
            lowess=True,
            line_kws={'color': 'red', 'lw': 1, 'alpha': 0.8})

plot_lm_3.axes[0].set_title('Scale-Location')
plot_lm_3.axes[0].set_xlabel('Fitted values')
plot_lm_3.axes[0].set_ylabel('$\sqrt{|Standardized Residuals|}$');


for i in abs_norm_resid_top_3:
    plot_lm_3.axes[0].annotate(i, 
                               xy=(model_fitted_y[i], 
                                   model_norm_residuals_abs_sqrt[i]));
</code></pre>

<p><img alt="png" src="../03_08_files/03_08_37_0.png" /></p>
<p>This plot is similar to the first one - it plots the residuals against the fitted values, although here they are all made positive and normalized.
It is clear from the plot that the assumption of homoscedasticity is not held.</p>
<p>"The third plot is a scale-location plot (square rooted standardized residual vs. predicted value). This is useful for checking the assumption of homoscedasticity. In this particular plot we are checking to see if there is a pattern in the residuals."</p>
<p>(source: http://sphweb.bumc.bu.edu/otlt/MPH-Modules/BS/R/R5_Correlation-Regression/R5_Correlation-Regression7.html)</p>
<h3 id="residuals-against-leverages">Residuals against leverages</h3>
<pre><code class="python">plot_lm_4 = plt.figure(4)
plot_lm_4.set_figheight(8)
plot_lm_4.set_figwidth(12)

plt.scatter(model_leverage, model_norm_residuals, alpha=0.5)
sns.regplot(model_leverage, model_norm_residuals, 
            scatter=False, 
            ci=False, 
            lowess=True,
            line_kws={'color': 'red', 'lw': 1, 'alpha': 0.8})

plot_lm_4.axes[0].set_xlim(0, 0.20)
plot_lm_4.axes[0].set_ylim(-3, 5)
plot_lm_4.axes[0].set_title('Residuals vs Leverage')
plot_lm_4.axes[0].set_xlabel('Leverage')
plot_lm_4.axes[0].set_ylabel('Standardized Residuals')

# annotations
leverage_top_3 = np.flip(np.argsort(model_cooks), 0)[:3]

for i in leverage_top_3:
    plot_lm_4.axes[0].annotate(i, 
                               xy=(model_leverage[i], 
                                   model_norm_residuals[i]))

# shenanigans for cook's distance contours
def graph(formula, x_range, label=None, ls='-'):
    x = x_range
    y = formula(x)
    plt.plot(x, y, label=label, lw=1, ls=ls, color='red')

p = len(model_fit.params) # number of model parameters

graph(lambda x: np.sqrt((0.5 * p * (1 - x)) / x), 
      np.linspace(0.001, 0.200, 50), 
      'Cook\'s distance = .5', ls='--') # 0.5 line

graph(lambda x: np.sqrt((1 * p * (1 - x)) / x), 
      np.linspace(0.001, 0.200, 50), 'Cook\'s distance = 1', ls=':') # 1 line

plt.legend(loc='upper right');
</code></pre>

<p><img alt="png" src="../03_08_files/03_08_40_0.png" /></p>
<p>The higher leverage points concentrate on the upper half of this plot, which indicates a deviation from normality.
On the other hand, from the plot we can see that every point has a Cook's distance well below 1, which indicates that no point has much individual influence on the fit.</p>
<p>"The fourth plot is of "Cook's distance", which is a measure of the influence of each observation on the regression coefficients. The Cook's distance statistic is a measure, for each observation in turn, of the extent of change in model estimates when that particular observation is omitted. Any observation for which the Cook's distance is close to 1 or more, or that is substantially larger than other Cook's distances (highly influential data points), requires investigation."</p>
<p>(source: http://sphweb.bumc.bu.edu/otlt/MPH-Modules/BS/R/R5_Correlation-Regression/R5_Correlation-Regression7.html)</p>
<h3 id="references_1">References</h3>
<p>[4] https://stat.ethz.ch/R-manual/R-devel/library/stats/html/plot.lm.html</p>
<p>[5] https://emredjan.github.io/blog/2017/07/11/emulating-r-plots-in-python/</p></div>
        
    </div>

    <footer class="col-md-12 text-center">
        <hr>
        <p>
        <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p></small>
    </footer>

    <script src="../../../js/jquery-1.10.2.min.js"></script>
    <script src="../../../js/bootstrap-3.0.3.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>
    var base_url = '../../..';
    </script>
    <script data-main="../../../mkdocs/js/search.js" src="../../../mkdocs/js/require.js"></script>
    <script src="../../../js/base.js"></script>
    <script src="../../../mathjax-config.js"></script>
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="../../../search/require.js"></script>
    <script src="../../../search/search.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    </body>

</html>
